<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“§ Panasonic è¯çµ¡ä¿¡ç®±å¿«é€Ÿè¤‡è£½</title>
<style>
body {
  font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
  background: #eef2f5;
  margin: 0; padding: 20px;
  color: #333;
}

h2 {
  text-align: center;
  margin-bottom: 14px;
  font-size: 1.3rem;
}

#tableWrapper {
  max-width: 1000px;
  margin: 0 auto;
}

/* =====================================
   è¶…è–„ç‰ˆ Tableï¼ˆä¸æ²è»¸ï¼‰
===================================== */
table {
  border-collapse: collapse;
  width: 100%;
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  font-size: 18px;
}

th, td {
  border: 1px solid #ccc;
  padding: 2px 4px;       /* â˜… å¹¾ä¹ç„¡ padding â†’ è‡ªç„¶è®Šè–„ */
  height: 22px;           /* â˜… row é«˜åº¦ç›´æ¥è®Šè–„ */
  white-space: nowrap;
  text-align: center;
  cursor: pointer;
  user-select: none;
}

th {
  background: #0078d7;
  color: #fff;
  font-size: 13px;
  padding: 6px 4px;       /* è¡¨é ­å¾®å¾®å¤§ä¸€é» */
}
th:hover { background: #005ea6; }

/* =====================================
   td æ•´æ ¼ã€ŒæŒ‰éˆ•åŒ–ã€
===================================== */
td {
  background: #f8f9fc;
  transition: 0.15s;
}

td:hover {
  background: #e4efff;     /* hover æ•´æ ¼äº®èµ· */
}

td.selected {
  background: #0078d7 !important;
  color: white !important;
  font-weight: bold;
  box-shadow: inset 0 0 3px rgba(0,0,0,0.2);
}

/* =====================================
   ç‹€æ…‹åˆ—
===================================== */
#status {
  text-align: center;
  margin-top: 10px;
  color: #0078d7;
  font-size: 13px;
  min-height: 1.2em;
}
</style>
</head>
<body>

<h2>ğŸ“§ Panasonic è¯çµ¡ä¿¡ç®±å¿«é€Ÿè¤‡è£½</h2>

<div id="tableWrapper">
<table id="mailTable">
  <tr>
    <th data-role="ALL">å€åŸŸ</th>
    <th data-role="è™•é•·">è™•é•·</th>
    <th data-role="ç¶“ç†">ç¶“ç†</th>
    <th data-role="ç«™é•·">ç«™é•·</th>
  </tr>
</table>
</div>

<div id="status">ï¼ˆæœªé¸å–ï¼‰</div>

<script type="module">
let selectedMails = new Set();
let table = document.getElementById("mailTable");

async function loadMails() {
  const res = await fetch("mails.json");
  const data = await res.json();

  data.forEach(row => {
    const tr = document.createElement("tr");
tr.innerHTML = `
  <td data-area="${row.å€åŸŸ}">${row.å€åŸŸ}</td>

  <td ${row.è™•é•·?.mail ? `data-mail="${row.è™•é•·.mail}"` : ""}>
    ${row.è™•é•·?.name || ""}
  </td>

  <td ${row.ç¶“ç†?.mail ? `data-mail="${row.ç¶“ç†.mail}"` : ""}>
    ${row.ç¶“ç†?.name || ""}
  </td>

  <td ${row.ç«™é•·?.mail ? `data-mail="${row.ç«™é•·.mail}"` : ""}>
    ${row.ç«™é•·?.name || ""}
  </td>
`;

    table.appendChild(tr);
  });
}

table.addEventListener("click", e => {
  const td = e.target.closest("td");
  const th = e.target.closest("th");

  if (td) handleTd(td);
  if (th) handleHeader(th.dataset.role);
});

function handleTd(td) {
  const area = td.dataset.area;

  // ============================
  // â˜… é»ã€Œå€åŸŸã€ï¼šæ•´åˆ— toggle
  // ============================
  if (area) {
    const tr = td.parentElement;

    // â†’ æ‰¾å‡ºæ‰€æœ‰æœ‰ mail çš„æ ¼å­ï¼ˆçœŸæ­£è¦è¢«é¸å–çš„ï¼‰
    const mailCells = Array.from(tr.querySelectorAll("td[data-mail]"))
                           .filter(c => c.dataset.mail.trim() !== "");

    // åˆ¤æ–·æ˜¯å¦å…¨éƒ¨ mail cell éƒ½è¢«é¸å–
    const allSelected = mailCells.every(c =>
      c.classList.contains("selected")
    );

    // â˜… mail cell åå‘ toggle
    mailCells.forEach(cell => {
      const mail = cell.dataset.mail;
      if (allSelected) {
        cell.classList.remove("selected");
        selectedMails.delete(mail);
      } else {
        cell.classList.add("selected");
        selectedMails.add(mail);
      }
    });

    // â˜… å€åŸŸæ ¼ä¹Ÿåšè¦–è¦ºåŒæ­¥ï¼ˆä½†ä¸åŠ å…¥ selectedMailsï¼‰
    if (allSelected) {
      td.classList.remove("selected");
    } else {
      td.classList.add("selected");
    }

    copyMails();
    return;
  }

  // ============================
  // â˜… é»ä¸€èˆ¬æ ¼ï¼šæ™®é€š toggle
  // ============================
  const mail = td.dataset.mail;
  if (!mail) return;

  if (td.classList.contains("selected")) {
    td.classList.remove("selected");
    selectedMails.delete(mail);
  } else {
    td.classList.add("selected");
    selectedMails.add(mail);
  }

  copyMails();
}




function handleHeader(role) {
  const rows = Array.from(table.querySelectorAll("tr")).slice(1);

  if (role === "ALL") {
    const tds = table.querySelectorAll("td[data-mail]");
    const allSelected = Array.from(tds).every(td => td.classList.contains("selected"));
    tds.forEach(td => toggleSelect(td, !allSelected));
  } else {
    const index = {"è™•é•·":1,"ç¶“ç†":2,"ç«™é•·":3}[role];
    const col = rows.map(r => r.children[index]).filter(td => td.dataset.mail);
    const allSelected = col.every(td => td.classList.contains("selected"));
    col.forEach(td => toggleSelect(td, !allSelected));
  }
  copyMails();
}



function toggleSelect(td, select) {
  const mail = td.dataset.mail;
  if (!mail) return;

  if (select) {
    td.classList.add("selected");
    selectedMails.add(mail);
  } else {
    td.classList.remove("selected");
    selectedMails.delete(mail);
  }
}

/* è¤‡è£½ */
function copyMails() {
  const arr = Array.from(selectedMails);
  const status = document.getElementById("status");

  if (!arr.length) {
    status.textContent = "ï¼ˆæœªé¸å–ï¼‰";
    return;
  }

  navigator.clipboard.writeText(arr.join("; ")).then(() => {
    status.textContent = `âœ” å·²è¤‡è£½ ${arr.length} å€‹`;
  });
}


loadMails();
</script>

</body>
</html>
