<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>æª”æ¡ˆæŸ¥è©¢</title>
  <style>
    :root {
  --primary: #0052cc; /* æ›´æ·±çš„è—è‰²ï¼Œå°ˆæ¥­æ„Ÿæ›´å¼· */
  --bg: #f6f8fc; /* æ›´æŸ”å’Œçš„èƒŒæ™¯è‰² */
  --card-bg: #ffffff;
  --text: #1f2a44; /* æ›´æ·±çš„æ–‡å­—è‰²ï¼Œæå‡å°æ¯” */
  --border: #e4e7eb; /* æ›´æŸ”å’Œçš„é‚Šæ¡†è‰² */
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* æ›´æ˜é¡¯çš„é™°å½± */
  --input-focus: #e6f0ff; /* èšç„¦æ™‚çš„èƒŒæ™¯è‰² */
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: 1.5rem; /* å¢åŠ å…§è· */
}

h1 {
  text-align: center;
  font-size: 1.5rem; /* å­—é«”ç¨å¤§ */
  font-weight: 700; /* æ›´ç²—çš„å­—é‡ */
  margin-bottom: 1.5rem;
  color: var(--text);
  letter-spacing: -0.02em; /* å­—è·å¾®èª¿ */
}

.search-container {
  max-width: 600px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œæ¡Œé¢ç«¯æ›´é›†ä¸­ */
  margin: 0 auto 1.5rem;
  position: relative;
  display: flex;
  align-items: center;
  background: var(--card-bg);
  border-radius: 12px; /* æ›´åœ“æ½¤çš„é‚Šè§’ */
  box-shadow: var(--shadow);
  transition: box-shadow 0.3s ease;
}

.search-container:hover {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12); /* æ‡¸åœæ™‚å¢å¼·é™°å½± */
}

.search-container input {
  width: 100%;
  padding: 0.9rem 0.9rem 0.9rem 3rem; /* å¢åŠ å·¦å´å…§è·ä»¥å®¹ç´åœ–æ¨™ */
  font-size: 1rem;
  border: none;
  border-radius: 12px;
  background: transparent; /* ç§»é™¤èƒŒæ™¯ï¼Œè®“å®¹å™¨æ§åˆ¶ */
  color: var(--text);
  transition: background 0.3s ease;
}

.search-container input:focus {
  outline: none;
  background: var(--input-focus); /* èšç„¦æ™‚èƒŒæ™¯è®Šæ·º */
  box-shadow: none; /* ç§»é™¤èšç„¦æ™‚çš„é¡å¤–é™°å½± */
}

.search-container::before {
  content: 'ğŸ”';
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2rem;
  opacity: 0.6;
  transition: opacity 0.3s ease;
}

.search-container input:focus + ::before {
  opacity: 0.8; /* èšç„¦æ™‚åœ–æ¨™æ›´é¡¯çœ¼ */
}

.results-container {
  max-width: 800px; /* é™åˆ¶è¡¨æ ¼æœ€å¤§å¯¬åº¦ */
  margin: 0 auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: var(--card-bg);
  box-shadow: var(--shadow);
  border-radius: 12px;
  overflow: hidden;
  table-layout: fixed;
}

th,
td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid var(--border);
}

th {
  background: #fafbfc; /* æ›´æŸ”å’Œçš„è¡¨é ­èƒŒæ™¯ */
  font-weight: 600;
  color: #333;
  font-size: 0.9rem;
}

td {
  font-weight: 500;
  font-size: 0.85rem;
}

tr:hover {
  background: #f5f7fa; /* æ‡¸åœèƒŒæ™¯æ›´æŸ”å’Œ */
}

td.icon {
  width: 40px;
  text-align: center;
  vertical-align: middle;
}

td.icon img {
  width: 24px; /* åœ–æ¨™ç¨å¤§ */
  height: 24px;
  vertical-align: middle;
}

td.name {
  word-break: break-all;
  white-space: normal;
}

td.description {
  word-break: break-all;
  white-space: normal;
  color: #5f6b7a; /* æè¿°æ–‡å­—æ›´æŸ”å’Œ */
}

td a {
  color: var(--primary);
  text-decoration: none;
  display: block;
  transition: color 0.2s ease;
}

td a:hover {
  color: #003d99; /* æ‡¸åœæ™‚é¡è‰²è®Šæ·± */
  text-decoration: none; /* ç§»é™¤ä¸‹åº•ç·šï¼Œä¿æŒä¹¾æ·¨ */
}

.message {
  padding: 1rem;
  text-align: center;
  font-weight: 500;
  color: #5f6b7a;
  background: var(--card-bg);
  border-radius: 12px;
  box-shadow: var(--shadow);
  margin-top: 1.5rem;
  font-size: 0.9rem;
}

.message.error {
  color: #d32f2f;
  background: #fff0f0;
}

@media (max-width: 768px) {
  body {
    padding: 1rem;
  }
  h1 {
    font-size: 1.25rem;
    margin-bottom: 1.25rem;
  }
  .search-container {
    max-width: 100%;
  }
  .search-container input {
    padding: 0.8rem 0.8rem 0.8rem 2.8rem;
    font-size: 0.95rem;
  }
  .search-container::before {
    left: 0.8rem;
    font-size: 1.1rem;
  }
  th,
  td {
    padding: 0.75rem;
    font-size: 0.8rem;
  }
  td.icon {
    width: 36px;
  }
  td.icon img {
    width: 20px;
    height: 20px;
  }
}

@media (max-width: 480px) {
  body {
    padding: 0.75rem;
  }
  h1 {
    font-size: 1.1rem;
  }
  .search-container input {
    padding: 0.7rem 0.7rem 0.7rem 2.5rem;
    font-size: 0.9rem;
  }
  .search-container::before {
    left: 0.7rem;
    font-size: 1rem;
  }
  th,
  td {
    padding: 0.5rem;
    font-size: 0.75rem;
  }
  td.icon {
    width: 32px;
  }
  td.icon img {
    width: 18px;
    height: 18px;
  }
}   
  </style>
</head>
<body>
  <h1>æª”æ¡ˆæŸ¥è©¢(æª”åæˆ–æè¿°æ¨¡ç³Šæ¯”å°)</h1>

  <div class="search-container">
    <input id="kw" type="text" placeholder="è¼¸å…¥é—œéµå­—â€¦" autocomplete="off" disabled>
  </div>

  <div class="results-container" id="results"></div>

  <script>
    const inputEl = document.getElementById('kw');
    const resultsEl = document.getElementById('results');
    let index = null;

    function getIconPath(name) {
      const ext = name.split('.').pop().toLowerCase();
      switch (ext) {
        case 'pdf':   return '../images/filetype/pdf.png';
        case 'doc':
        case 'docx':  return '../images/filetype/word.png';
        case 'xls':
        case 'xlsx':  return '../images/filetype/excel.png';
        case 'mp4':   return '../images/filetype/video.png';
        case 'png':   return '../images/filetype/png.png';
        case 'jpg':
        case 'jpeg':  return '../images/filetype/jpg.png';
        case 'gif':   return '../images/filetype/gif.png';
        default:      return '../images/filetype/document.png';
      }
    }

    function fuzzyMatch(file, terms) {
      const lowerName = file.name.toLowerCase();
      const lowerDesc = (file.description || '').toLowerCase();
      // Split by spaces, filter out empty terms
      const keywords = terms.trim().toLowerCase().split(/\s+/).filter(t => t);
      // All keywords must match in either name or description (AND condition)
      return keywords.every(keyword => {
        // Escape special regex characters and match the exact keyword
        const pattern = keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        return new RegExp(pattern).test(lowerName) || new RegExp(pattern).test(lowerDesc);
      });
    }

    function doSearch(term) {
      resultsEl.innerHTML = '<div class="message">ğŸ”„ æœå°‹ä¸­â€¦</div>';
      
      if (!term.trim()) {
        resultsEl.innerHTML = '';
        return;
      }

      try {
        const results = index.files.filter(f => fuzzyMatch(f, term));
        if (!results.length) {
          resultsEl.innerHTML = '<div class="message">ğŸ” ç„¡ç¬¦åˆæª”æ¡ˆ</div>';
        } else {
          resultsEl.innerHTML = `
            <table>
              <thead>
                <tr>
                  <th style="width: 40px;"></th>
                  <th>æª”æ¡ˆåç¨±</th>
                  <th>æè¿°</th>
                </tr>
              </thead>
              <tbody>
                ${results.map(f => `
                  <tr>
                    <td class="icon"><img src="${getIconPath(f.name)}" alt=""></td>
                    <td class="name"><a href="${f.webViewLink}" target="_blank">${f.name}</a></td>
                    <td class="description">${f.description || '-'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
        }
      } catch (err) {
        resultsEl.innerHTML = `<div class="message error">éŒ¯èª¤ï¼š${err.message}</div>`;
      }
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    (async () => {
      try {
        const res = await fetch('drive_index.json');
        index = await res.json();
        inputEl.disabled = false;
        inputEl.focus();
        
        const debouncedSearch = debounce(doSearch, 300);
        inputEl.addEventListener('input', (e) => {
          debouncedSearch(e.target.value);
        });
      } catch (err) {
        resultsEl.innerHTML = `<div class="message error">éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥ç´¢å¼• (${err.message})</div>`;
      }
    })();
  </script>
</body>
</html>